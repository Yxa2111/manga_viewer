(function(e){function t(t){for(var n,l,i=t[0],c=t[1],s=t[2],d=0,f=[];d<i.length;d++)l=i[d],Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&f.push(o[l][0]),o[l]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(f.length)f.shift()();return a.push.apply(a,s||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,i=1;i<r.length;i++){var c=r[i];0!==o[c]&&(n=!1)}n&&(a.splice(t--,1),e=l(l.s=r[0]))}return e}var n={},o={app:0},a=[];function l(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.m=e,l.c=n,l.d=function(e,t,r){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(l.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(r,n,function(t){return e[t]}.bind(null,n));return r},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var u=c;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},1:function(e,t){},"107d":function(e,t,r){},"11cc":function(e,t,r){},"1c3a":function(e,t,r){"use strict";var n=r("972e"),o=r.n(n);o.a},2:function(e,t){},"373b":function(e,t,r){},"435f":function(e,t,r){"use strict";var n=r("107d"),o=r.n(n);o.a},"445d":function(e,t,r){"use strict";var n=r("373b"),o=r.n(n);o.a},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("router-view")},a=[],l={name:"App",components:{}},i=l,c=r("2877"),s=Object(c["a"])(i,o,a,!1,null,null,null),u=s.exports,d=r("8c4f"),f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("file-selector-component")],1)},g=[],p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"file-selector"},[r("div",{staticClass:"selector"},[r("label",{staticClass:"file-input"},[r("input",{ref:"fileInput",attrs:{type:"file"},on:{change:e.fileSelectorChange}}),e._v("打开 ")])]),r("div",{staticClass:"last-read"},[e._v("上次閲讀："+e._s(e.currentTitleText))]),r("div",{staticClass:"history-slot-selector"},[r("select",{directives:[{name:"model",rawName:"v-model",value:e.slot,expression:"slot"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.slot=t.target.multiple?r:r[0]}}},e._l(e.slotList,(function(t){return r("option",{key:t,domProps:{value:t}},[e._v(e._s(e.getSlotTitle(t)))])})),0)]),r("div",{staticClass:"history-slot-selector-btn"},[r("button",{on:{click:e.clickAddSlotBtn}},[e._v("添加")]),r("button",{on:{click:e.clickDelSlotBtn}},[e._v("刪除")]),r("button",{on:{click:e.clickDelAllSlotBtn}},[e._v("全部刪除")])]),e._m(0)])},h=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"copy"},[r("a",{attrs:{href:"https://github.com/stevennight/manga-viewer"}},[e._v("stevennight@github")])])}],m=(r("c975"),r("5530")),b=r("2f62"),v={name:"FileSelector",methods:Object(m["a"])({fileSelectorChange:function(e){var t=e.target.files;this.changeCurrentFile(t),this.$router.push("/reader")},clickAddSlotBtn:function(){var e=parseInt((new Date).getTime()/1e3),t=e,r=0;while(this.slotList.indexOf(t)>-1)t=e+"-"+r,r++;this.addSlotList(t),this.changeSlotAction(t)},clickDelSlotBtn:function(){"default"!==this.slot?confirm("確定刪除（"+this.getSlotTitle(this.slot)+"）嗎？數據將無法恢復")&&(this.delSlotList(this.slot),this.changeSlotAction(this.slot)):alert("默認記錄槽無法刪除")},clickDelAllSlotBtn:function(){confirm("確定全部刪除嗎？數據將無法恢復")&&(this.delSlotListAll(),this.changeSlotAction(this.slot))},getSlotTitle:function(e){var t=e;"default"===t&&(t="默認");try{void 0===localStorage["currentTitle"+e]?t+="(無歷史記錄)":localStorage["currentTitle"+e]?t+="(".concat(localStorage["currentTitle"+e],")"):t+="(無歷史記錄)"}catch(r){}return t}},Object(b["d"])(["changeCurrentFile","addSlotList","delSlotList","delSlotListAll"]),{},Object(b["b"])(["changeSlotAction"])),computed:Object(m["a"])({},Object(b["e"])(["currentFile","currentTitle","currentPage","slot","slotList"]),{currentTitleText:function(){return this.currentTitle?this.currentTitle+"-第"+this.currentPage+"頁":"無"},slot:{get:function(){return this.$store.state.slot},set:function(e){this.changeSlotAction(e)}}}),mounted:function(){this.$refs.fileInput.value=""}},S=v,w=(r("deeb"),Object(c["a"])(S,p,h,!1,null,"ec89fa90",null)),C=w.exports,O={name:"Index",components:{FileSelectorComponent:C}},T=O,y=Object(c["a"])(T,f,g,!1,null,"61a4c52e",null),_=y.exports,j=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("fullscreen",{ref:"fullscreen",on:{change:e.fullscreenChange}},[r("header-component",{directives:[{name:"show",rawName:"v-show",value:e.showController,expression:"showController"}]}),e.blobList.length?r(e.readerMode,{tag:"div",attrs:{blobList:e.blobList},on:{imageclick:e.imageClick}}):e._e(),r("controller-component",{directives:[{name:"show",rawName:"v-show",value:e.showController,expression:"showController"}],on:{toggleFullScreen:e.toggleFullScreen}})],1)],1)},k=[],L=(r("4160"),r("b0c0"),r("a9e3"),r("25eb"),r("d3b7"),r("4d63"),r("ac1f"),r("25f0"),r("3ca3"),r("466d"),r("159b"),r("ddb0"),r("2b3d"),r("7c39")),P=r.n(L),x=r("03cd"),$=r.n(x),M=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{key:"images-wrapper",ref:"images-wrapper",staticClass:"images-wrapper",on:{click:e.imageClick}},[r("div",e._l(e.blobList,(function(t,n){return r("div",{key:t.name,ref:"images-"+n,refInFor:!0,staticClass:"image-wrapper"},[r("img",{attrs:{src:t.blob},on:{load:e.fixImageScroll}})])})),0),r("div",{staticClass:"pagination"},[r("span",[e._v(e._s(e.currentPage)+"/"+e._s(e.currentTotal))])])])},F=[],R=r("1fba"),A={name:"ColumnReader",props:{blobList:{type:Array,default:function(){return[]}}},data:function(){return{selfChangePage:0}},computed:Object(m["a"])({},Object(b["e"])(["currentTitle","currentTotal","currentPage"]),{},Object(b["c"])(["currentGetters"])),methods:Object(m["a"])({},Object(b["d"])(["changeCurrent"]),{imageClick:function(){this.$emit("imageclick")},imagesScroll:function(){for(var e=this.$refs["images-wrapper"].offsetHeight/2,t=this.currentTotal,r=0;r<t;r++)if(this.$refs["images-"+r][0].getBoundingClientRect().bottom>e)break;console.log(this.$refs["images-"+r][0].getBoundingClientRect().bottom),console.log("滾動："+r),this.selfChangePage=r,this.changeCurrent({currentPage:r+1})},fixImageScroll:function(){this.scroll.refresh();var e=this.currentPage-1;this.scroll.scrollToElement(this.$refs["images-"+e][0])}}),watch:{currentPage:function(){var e=this.currentPage-1;e!==this.selfChangePage&&this.scroll.scrollToElement(this.$refs["images-"+e][0])}},mounted:function(){this.scroll=new R["a"](this.$refs["images-wrapper"],{click:!0,mouseWheel:{speed:20,invert:!1,easeTime:300}}),this.scroll.on("touchEnd",this.imagesScroll)},destroyed:function(){delete this.scroll}},E=A,I=(r("445d"),Object(c["a"])(E,M,F,!1,null,"34c9daf4",null)),B=I.exports,D=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"swiper-container",on:{click:e.imageClick}},[r("swiper",{ref:"mySwiper",staticClass:"swiper-wrapper",attrs:{options:e.swiperOptions},on:{slideChange:e.swiperSlideChange}},[e._l(e.blobList,(function(e){return r("swiper-slide",{key:e.name,staticClass:"swiper-slide"},[r("div",{staticClass:"swiper-zoom-container"},[r("img",{attrs:{src:e.blob}})])])})),r("div",{staticClass:"swiper-pagination",attrs:{slot:"pagination"},slot:"pagination"})],2)],1)},N=[],z={name:"RowReader",props:{blobList:{type:Array,default:function(){return[]}},type:String},data:function(){return{swiperOptions:{initialSlide:this.$store.state.currentPage-1,pagination:{el:".swiper-pagination",type:"custom",renderCustom:function(e,t,r){return"<span>"+t+" / "+r+"</span>"}},keyboard:!0,mousewheel:!0,zoom:!0}}},computed:Object(m["a"])({},Object(b["e"])(["currentTitle","currentTotal","currentPage"]),{},Object(b["c"])(["currentGetters"]),{swiper:function(){return this.$refs.mySwiper.swiper}}),methods:Object(m["a"])({},Object(b["d"])(["changeCurrent"]),{imageClick:function(){this.$emit("imageclick")},swiperSlideChange:function(){this.changeCurrent({currentPage:this.swiper.realIndex+1})}}),watch:{currentPage:function(){var e=this.swiper,t=e.realIndex,r=this.currentPage-1;t!==r&&e.slideTo(r,100,!1)}}},J=z,U=(r("1c3a"),Object(c["a"])(J,D,N,!1,null,"ffb46bfa",null)),G=U.exports,H=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"swiper-container",on:{click:e.imageClick}},[r("swiper",{ref:"mySwiper",staticClass:"swiper-wrapper",attrs:{options:e.swiperOptions,dir:"rtl"},on:{slideChange:e.swiperSlideChange}},[e._l(e.blobList,(function(e){return r("swiper-slide",{key:e.name,staticClass:"swiper-slide"},[r("div",{staticClass:"swiper-zoom-container"},[r("img",{attrs:{src:e.blob}})])])})),r("div",{staticClass:"swiper-pagination",attrs:{slot:"pagination"},slot:"pagination"})],2)],1)},Z=[],V={name:"RowReaderReserve",props:{blobList:{type:Array,default:function(){return[]}}},data:function(){return{swiperOptions:{initialSlide:this.$store.state.currentPage-1,pagination:{el:".swiper-pagination",type:"custom",renderCustom:function(e,t,r){return"<span>"+r+" / "+t+"</span>"}},keyboard:!0,mousewheel:!0,zoom:!0}}},computed:Object(m["a"])({},Object(b["e"])(["currentTitle","currentTotal","currentPage"]),{},Object(b["c"])(["currentGetters"]),{swiper:function(){return this.$refs.mySwiper.swiper}}),methods:Object(m["a"])({},Object(b["d"])(["changeCurrent"]),{imageClick:function(){this.$emit("imageclick")},swiperSlideChange:function(){this.changeCurrent({currentPage:this.swiper.realIndex+1})}}),watch:{currentPage:function(){var e=this.swiper,t=e.realIndex,r=this.currentPage-1;t!==r&&e.slideTo(r,100,!1)}}},W=V,q=(r("756a"),Object(c["a"])(W,H,Z,!1,null,"1933590a",null)),K=q.exports,Q=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"controller-wrapper"},[r("div",{staticClass:"controller-slide-wrapper",style:{flexDirection:e.vueSliderFlexDirection}},[r("div",{staticClass:"controller-slide-text"},[e._v(e._s(e.currentPage)+"/"+e._s(e.currentTotal))]),r("div",{staticClass:"controller-slide"},[r("vue-slider",{attrs:{min:1,max:e.currentTotal,interval:1,"drag-on-click":!0,direction:e.vueSliderDirection},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1)]),r("div",{staticClass:"controller-btn-wrapper"},[r("div",{staticClass:"controller-btn",class:{"controller-btn-active":"row-reader-component"===e.readerMode},on:{click:function(t){return e.changeReaderMode("row-reader-component")}}},[e._v(" 从左到右 ")]),r("div",{staticClass:"controller-btn",class:{"controller-btn-active":"row-reader-reverse-component"===e.readerMode},on:{click:function(t){return e.changeReaderMode("row-reader-reverse-component")}}},[e._v(" 从右到左 ")]),r("div",{staticClass:"controller-btn",class:{"controller-btn-active":"column-reader-component"===e.readerMode},on:{click:function(t){return e.changeReaderMode("column-reader-component")}}},[e._v(" 条漫模式 ")]),r("div",{staticClass:"controller-btn",on:{click:e.toggleFullScreen}},[e._v(" 全屏 ")]),r("div",{staticClass:"controller-btn",on:{click:e.back}},[e._v(" 返回 ")])])])},X=[],Y={name:"Controller",computed:Object(m["a"])({},Object(b["e"])(["readerMode","currentTitle","currentTotal","currentPage"]),{page:{get:function(){return this.currentPage},set:function(e){this.changeCurrent({currentPage:e})}},vueSliderDirection:function(){switch(this.readerMode){case"row-reader-reverse-component":return"rtl";default:return"ltr"}},vueSliderFlexDirection:function(){switch(this.readerMode){case"row-reader-reverse-component":return"row-reverse";default:return"row"}}}),methods:Object(m["a"])({},Object(b["d"])(["changeReaderMode","changeCurrent"]),{back:function(){this.$router.push("/")},toggleFullScreen:function(){this.$emit("toggleFullScreen")}})},ee=Y,te=(r("435f"),Object(c["a"])(ee,Q,X,!1,null,"aae1e750",null)),re=te.exports,ne=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"header-container"},[e._v(" "+e._s(e.currentTitle)+" ")])},oe=[],ae={name:"Header",computed:Object(m["a"])({},Object(b["e"])(["currentTitle"]))},le=ae,ie=(r("6b09"),Object(c["a"])(le,ne,oe,!1,null,"0a88b8a2",null)),ce=ie.exports;n["default"].use($.a);var se={name:"Reader",data:function(){return{fullscreen:!1,showController:!0,blobList:[]}},components:{ColumnReaderComponent:B,RowReaderComponent:G,RowReaderReverseComponent:K,ControllerComponent:re,HeaderComponent:ce},computed:Object(m["a"])({},Object(b["e"])(["currentFile","readerMode","currentTitle","currentTotal","currentPage"])),methods:Object(m["a"])({},Object(b["d"])(["changeCurrentFile","changeCurrent"]),{imageClick:function(){this.showController=!this.showController},readComicFile:function(){var e=this.currentFile;if(e instanceof File||e instanceof FileList)if(e.length>1)this.readComicFileDir(e);else{var t=e[0],r=t.name,n=new RegExp(/(.*)\.(.*?)$/),o=r.match(n);switch(console.log(o),o&&(r=o[1]),console.log(this.currentTitle),this.currentTitle!==r?this.changeCurrent({currentTitle:r,currentPage:1}):this.changeCurrent({currentTitle:r}),t.type){case"application/x-zip-compressed":case"application/zip":this.readComicFileZip(t);break;default:alert("不支持文件格式"+t.type)}}else this.$router.push("/")},readComicFileZip:function(e){var t=this,r=[],n=0,o=0;P.a.loadAsync(e).then((function(e){e.forEach((function(e,a){n++,a.dir||a.async("blob").then((function(e){r.push({name:a.name,blob:window.URL.createObjectURL(e)}),o++,o===n&&t.sortBlobList(r)}))}))}),(function(){alert("读取zip出错")}))},readComicFileDir:function(e){var t=[];e.forEach((function(e){t.push({name:e.name,blob:window.URL.createObjectURL(new Blob([e]))})})),this.sortBlobList(t)},sortBlobList:function(e){e.sort((function(e,t){var r=Number.parseInt(e.name),n=Number.parseInt(t.name);return r<n?-1:r===n?0:1})),this.changeCurrent({currentTotal:e.length}),this.blobList=e},toggleFullScreen:function(){this.$refs["fullscreen"].toggle()},fullscreenChange:function(e){this.fullscreen=e}}),mounted:function(){var e=this;this.readComicFile(),setTimeout((function(){e.showController=!1}),2e3)}},ue=se,de=Object(c["a"])(ue,j,k,!1,null,"c39949d2",null),fe=de.exports,ge=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div")},pe=[],he={name:"404.html",mounted:function(){location.href="/custom/404.html"}},me=he,be=Object(c["a"])(me,ge,pe,!1,null,null,null),ve=be.exports;n["default"].use(d["a"]);var Se=[{path:"/",component:_},{path:"/reader",component:fe},{path:"*",component:ve}],we=new d["a"]({routes:Se}),Ce=we,Oe="row-reader-component",Te="",ye=1,_e=1,je="default",ke=["default"];try{localStorage.slot&&(je=localStorage.slot),localStorage.slotList&&(ke=JSON.parse(localStorage.slotList)),void 0===localStorage["readerMode"+je]&&(je="default"),localStorage["readerMode"+je]&&(Oe=localStorage["readerMode"+je]),localStorage["currentTitle"+je]&&(Te=localStorage["currentTitle"+je]),localStorage["currentTotal"+je]&&(ye=parseInt(localStorage["currentTotal"+je])),localStorage["currentPage"+je]&&(_e=parseInt(localStorage["currentPage"+je]))}catch(Be){}var Le={slot:je,slotList:ke,currentFile:{},currentTitle:Te,currentTotal:ye,currentPage:_e,readerMode:Oe},Pe={changeSlotAction:function(e,t){try{e.commit("changeSlot",t);var r="row-reader-component",n="",o=1,a=1;localStorage["readerMode"+t]&&(r=localStorage["readerMode"+t]),localStorage["currentTitle"+t]&&(n=localStorage["currentTitle"+t]),localStorage["currentTotal"+t]&&(o=parseInt(localStorage["currentTotal"+t])),localStorage["currentPage"+t]&&(a=parseInt(localStorage["currentPage"+t])),console.log(r),e.commit("changeReaderMode",r),e.commit("changeCurrent",{currentTitle:n,currentTotal:o,currentPage:a})}catch(Be){}}},xe=(r("a434"),{changeSlot:function(e,t){e.slot=t;try{localStorage.slot=t}catch(Be){}},addSlotList:function(e,t){e.slotList.push(t),localStorage.slotList=JSON.stringify(e.slotList),localStorage["readerMode"+t]="row-reader-component",localStorage["currentTitle"+t]="",localStorage["currentTotal"+t]=1,localStorage["currentPage"+t]=1},delSlotList:function(e,t){e.slot="default";try{localStorage.slot="default"}catch(Be){}try{if("default"===t)return;var r=e.slotList.indexOf(t);-1!==r&&e.slotList.splice(r,1),localStorage.slotList=JSON.stringify(e.slotList),delete localStorage["readerMode"+t],delete localStorage["currentTitle"+t],delete localStorage["currentTotal"+t],delete localStorage["currentPage"+t]}catch(Be){}},delSlotListAll:function(e){e.slot="default";try{localStorage.slot="default"}catch(Be){}try{e.slotList.forEach((function(e){"default"!==e&&(delete localStorage["readerMode"+e],delete localStorage["currentTitle"+e],delete localStorage["currentTotal"+e],delete localStorage["currentPage"+e])})),e.slotList.splice(1,e.slotList.length-1),localStorage.slotList=JSON.stringify(e.slotList)}catch(Be){}},changeCurrentFile:function(e,t){e.currentFile=t},changeCurrent:function(e,t){for(var r in t)e[r]=t[r],localStorage[r+e.slot]=t[r]},changeReaderMode:function(e,t){console.log(t),e.readerMode=t;try{localStorage["readerMode"+e.slot]=t}catch(Be){}}}),$e={};n["default"].use(b["a"]);var Me=new b["a"].Store({state:Le,actions:Pe,mutations:xe,getters:$e}),Fe=Me,Re=r("7212"),Ae=r.n(Re),Ee=r("4971"),Ie=r.n(Ee);r("7371"),r("aa47"),r("dfa4"),r("24df");n["default"].use(Ae.a),n["default"].component("VueSlider",Ie.a),n["default"].config.productionTip=!1,new n["default"]({router:Ce,store:Fe,render:function(e){return e(u)}}).$mount("#app")},"590f":function(e,t,r){},"6b09":function(e,t,r){"use strict";var n=r("f4a2"),o=r.n(n);o.a},7371:function(e,t,r){},"756a":function(e,t,r){"use strict";var n=r("11cc"),o=r.n(n);o.a},"972e":function(e,t,r){},aa47:function(e,t,r){},deeb:function(e,t,r){"use strict";var n=r("590f"),o=r.n(n);o.a},f4a2:function(e,t,r){}});
//# sourceMappingURL=app.1b1b748a.js.map